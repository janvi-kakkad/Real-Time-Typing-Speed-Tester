<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Real-Time Typing Speed Test</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <div class="container">
    <h1>⚡ Real-Time Typing Speed Tester</h1>

    <div class="controls">
      <label>Difficulty:
        <select id="difficulty">
          <option value="beginner">Beginner</option>
          <option value="intermediate">Intermediate</option>
          <option value="pro">Pro</option>
        </select>
      </label>

      <label>Duration:
        <select id="duration">
          <option value="30">30s</option>
          <option value="60">60s</option>
        </select>
      </label>
      <button id="start">▶ Start</button>
    </div>

    <div id="quote" class="quote"></div>

    <textarea id="input-area" placeholder="Start typing here..." disabled></textarea>

    <div class="stats">
      <p>⏳ Time Left: <span id="timer">0</span>s</p>
      <p>💨 WPM: <span id="wpm">0</span></p>
      <p>🎯 Accuracy: <span id="accuracy">100</span>%</p>
    </div>

    <button id="restart">🔄 Restart</button>
  </div>

  <!-- Load your word bank -->
  <script src="word.js"></script>

  <script>
    const quoteElement = document.getElementById("quote");
    const inputArea = document.getElementById("input-area");
    const timerElement = document.getElementById("timer");
    const wpmElement = document.getElementById("wpm");
    const accuracyElement = document.getElementById("accuracy");
    const restartBtn = document.getElementById("restart");
    const startBtn = document.getElementById("start");
    const durationSelect = document.getElementById("duration");
    const difficultySelect = document.getElementById("difficulty");

    // Fallback quotes if word.js failed to load
    const fallbackQuotes = [
      "The quick brown fox jumps over the lazy dog",
      "Typing fast requires practice and focus",
      "Programming is fun when you enjoy the process",
      "Small steps every day create big results"
    ];

    let timeLeft = 0;
    let interval = null;
    let currentQuote = "";
    let isGameRunning = false;

    function safeGenerateQuote() {
      // If word.js loaded correctly, use it
      if (typeof generateQuote === "function") {
        const difficulty = difficultySelect.value;
        const wordCount =
          difficulty === "beginner" ? 8 :
          difficulty === "intermediate" ? 12 : 16;
        return generateQuote(difficulty, wordCount);
      }
      // Otherwise, fall back to a static quote
      return fallbackQuotes[Math.floor(Math.random() * fallbackQuotes.length)];
    }

    function renderQuote(text) {
      quoteElement.innerHTML = "";
      text.split("").forEach(char => {
        const span = document.createElement("span");
        span.innerText = char;
        quoteElement.appendChild(span);
      });
    }

    function loadNewQuote() {
      currentQuote = safeGenerateQuote();
      renderQuote(currentQuote);
      inputArea.value = "";
    }

    function resetStats() {
      clearInterval(interval);
      timerElement.textContent = "0";
      wpmElement.textContent = "0";
      accuracyElement.textContent = "100";
      isGameRunning = false;
      inputArea.disabled = true;
    }

    function startGame() {
      loadNewQuote();
      timeLeft = parseInt(durationSelect.value, 10);
      timerElement.textContent = timeLeft;
      inputArea.disabled = false;
      inputArea.focus();
      isGameRunning = true;

      clearInterval(interval);
      interval = setInterval(() => {
        timeLeft--;
        timerElement.textContent = timeLeft;
        calculateWPM();

        if (timeLeft <= 0) {
          clearInterval(interval);
          inputArea.disabled = true;
          isGameRunning = false;
        }
      }, 1000);
    }

    function calculateWPM() {
      const wordsTyped = inputArea.value.trim().split(/\s+/).filter(Boolean).length;
      const timeSpent = parseInt(durationSelect.value, 10) - timeLeft;
      if (timeSpent > 0) {
        const wpm = Math.round((wordsTyped / timeSpent) * 60);
        wpmElement.textContent = wpm > 0 ? wpm : 0;
      }
    }

    function calculateAccuracy() {
      let correctChars = 0;
      const quoteSpans = quoteElement.querySelectorAll("span");
      const inputChars = inputArea.value.split("");

      quoteSpans.forEach((charSpan, index) => {
        const typedChar = inputChars[index];
        if (typedChar == null) {
          charSpan.classList.remove("correct", "incorrect");
        } else if (typedChar === charSpan.innerText) {
          charSpan.classList.add("correct");
          charSpan.classList.remove("incorrect");
          correctChars++;
        } else {
          charSpan.classList.add("incorrect");
          charSpan.classList.remove("correct");
        }
      });

      const accuracy = Math.round((correctChars / currentQuote.length) * 100);
      accuracyElement.textContent = Number.isFinite(accuracy) ? accuracy : 100;
    }

    inputArea.addEventListener("input", () => {
      if (isGameRunning) calculateAccuracy();
    });

    startBtn.addEventListener("click", () => {
      resetStats();
      startGame();
    });

    restartBtn.addEventListener("click", () => {
      resetStats();
      startGame();
    });

    // Prepare an initial quote (input remains disabled until Start)
    window.onload = loadNewQuote;
  </script>
</body>
</html>
